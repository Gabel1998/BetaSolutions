<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/header :: head}">
    <title>Overview</title>
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<main class="content">

    <!-- Show Login Prompt if NOT logged in -->
    <section class="login-prompt text-center card" th:if="${session.user == null}">
        <p>Please log in to view your projects</p>
        <a th:href="@{/auth/login}" class="button">Login</a>
    </section>

    <!-- Show Projects if Logged in -->
    <section th:if="${session.user != null}">
        <h2>Projects</h2>

        <div th:if="${successMessage}" class="message success" th:text="${successMessage}"></div>

        <!-- rækkefølge efter deadline? -> sprint 2 -->
        <section class="projects">
            <h2>Latest Updated Projects</h2>
            <div class="project-list">
                <a th:each="project : ${projects}"
                   th:href="@{'/subprojects?projectId=' + ${project.id}}"
                   class="project-card">

                    <h3 th:text="${project.name}">Projekt Name</h3>
                    <p th:text="${project.description}">Description</p>
                    <p>Start: <span th:text="${project.startDate}"></span></p>
                    <p>End: <span th:text="${project.endDate}"></span></p>

                <p th:if="${projectHours != null and projectHours.containsKey(project.id)}">
                    Estimated hours: <span th:text="${#numbers.formatDecimal(projectHours.get(project.id).get('estimatedHours'), 1, 1)}">0.0</span>
                </p>
                <p th:if="${projectHours != null and projectHours.containsKey(project.id)}">
                    Actual hours: <span th:text="${#numbers.formatDecimal(projectHours.get(project.id).get('actualHours'), 1, 1)}">0.0</span>
                </p>
                <p th:if="${adjustedHours != null and adjustedHours.containsKey(project.id)}">
                    Justerede timer: <span th:text="${#numbers.formatDecimal(adjustedHours.get(project.id), 1, 1)}">0.0</span>
                </p>
                <p th:if="${projectCo2 != null and projectCo2.containsKey(project.id)}">
                    CO₂-usage: <span th:text="${#numbers.formatDecimal(projectCo2.get(project.id), 1, 1)}">0.0</span>
                </p>

                    <form th:action="@{'/projects/delete/' + ${project.id}}" method="get">
                        <button class="button" type="submit" onclick="return confirm('Are you sure you want to delete this project?');">Delete Project</button>
                    </form>
                </a>

            </div>
        </section>

        <div class="two-buttons">
            <a class="button button--create" th:href="@{/projects/create}">
                + Create New Project
            </a>
        </div>

    </section>

</main>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>

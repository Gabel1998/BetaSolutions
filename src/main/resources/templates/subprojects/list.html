<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/header :: head}">
    <title>Subproject Overview</title>
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<main class="content">

    <!-- Show Login Prompt if NOT logged in -->
    <section class="login-prompt text-center card" th:if="${session.user == null}">
        <p>Please log in to view your subprojects</p>
        <a th:href="@{/auth/login}" class="button">Login</a>
    </section>

    <!-- Show Subprojects if Logged in -->
    <section th:if="${session.user != null}">
        <div th:if="${project != null}">
            <p th:text="'Subprojects for: ' + ${project.name}">Fallback text</p>
        </div>
        <div th:if="${project == null}">
            <p style="color: red;">⚠️ Project not properly loaded in the model!</p>
        </div>

        <div class="top-bar">
            <h2 th:text="${project != null} ? ${project.name} : 'Unknown project'">Project Name</h2>
            <a class="button" th:href="@{'/projects/edit/' + ${project.id}}">Edit Project</a>
        </div>

        <div th:if="${successMessage}" class="message success" th:text="${successMessage}"></div>

        <section class="item-list">
            <a th:each="sub : ${subProjects}"
               th:href="@{'/tasks?subProjectId=' + ${sub.id}}"
               class="item-card">

                <h3 th:text="${sub.name}">Subproject Name</h3>
                <p th:text="${sub.description}">Description</p>
                <p>Start: <span th:text="${sub.startDate}"></span></p>
                <p>End: <span th:text="${sub.endDate}"></span></p>

                <p th:if="${subProjectHours != null and subProjectHours.containsKey(sub.id)}">
                    Estimated Hours: <span th:text="${#numbers.formatDecimal(subProjectHours.get(sub.id).get('estimatedHours'), 1, 1)}">0.0</span>
                </p>
                <p th:if="${subProjectHours != null and subProjectHours.containsKey(sub.id)}">
                    Actual Hours: <span th:text="${#numbers.formatDecimal(subProjectHours.get(sub.id).get('actualHours'), 1, 1)}">0.0</span>
                </p>

                <a th:href="@{/subprojects/{id}/gantt(id=${sub.id})}" class="button">Download Gantt Diagram</a>

            </a>
        </section>

        <div class="create-button-container">
            <a class="button" th:href="@{'/subprojects/create?projectId=' + ${project.id}}">+ Create New Subproject</a>
        </div>
    </section>

</main>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
